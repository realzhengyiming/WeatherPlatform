{% extends 'weather_show_app/index_charts.html' %}
    {% load city_tags %}

{#å¤šappçš„æ–¹æ¡ˆä¸­templateéœ€è¦è¿™æ ·æ¥å¼•å…¥ï¼Œviewä¸­ä¹Ÿæ˜¯éœ€è¦åŠ ä¸Š#}
{% block title %}
{{ app_name }}
{% endblock %}

{% block drawer_body %}mdui-drawer-body-left{% endblock %}

{% block drawer_icon %}
    <span class=" mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white" mdui-drawer="{target: '#main-drawer', swipe: true}"><i class="mdui-icon material-icons">menu</i></span>
{% endblock %}

{% block drawer %}
<div class="mdui-drawer " id="main-drawer">
  <div class="mdui-list" mdui-collapse="{accordion: true}" style="margin-bottom: 76px;">
    <div class="mdui-collapse-item ">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">near_me</i>
        <div class="mdui-list-item-content">å¼€å§‹ä½¿ç”¨</div>
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list  ">
      <a href="{%url 'weather_show_app:index' %}" class="mdui-list-item mdui-ripple">æ•°æ®æ¦‚ç•¥</a>
        <a href="{% url 'weather_show_app:detaillist' %}" class="mdui-list-item mdui-ripple ">è¯¦ç»†æ•°æ®</a>
         </div>
  </div>

         <div class="mdui-collapse-item mdui-collapse-item-open">
      <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
        <!--<i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">near_me</i>-->
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">insert_chart</i>
        <div class="mdui-list-item-content">åˆ†æ</div>
          <!--<i class="mdui-collapse-item-arrow mdui-icon material-icons">insert_chart</i>-->
        <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
      </div>
      <div class="mdui-collapse-item-body mdui-list  mdui-collapse-item-open  ">
           <a href="{% url 'weather_show_app:host' %}" class="mdui-list-item mdui-ripple mdui-list-item-active">å„åŸå¸‚å½“å¤©å¤©æ°”åˆ†æ</a>
<!--          &lt;!&ndash;<a href="{% url 'weather_show_app:consumer' %}" class="mdui-list-item mdui-ripple ">æˆ¿å®¢ä¸“åŒº</a>&ndash;&gt;-->
<!--    <a href="{% url 'weather_show_app:price' %}" class="mdui-list-item mdui-ripple ">æˆ¿æºä»·æ ¼åˆ†æ</a>-->
<!--       &lt;!&ndash;<a href="{% url 'weather_show_app:detaillist' %}" class="mdui-list-item mdui-ripple ">åœ°ç†ä½ç½®åˆ†æ</a>&ndash;&gt;-->
<!--        <a href="{% url 'weather_show_app:time' %}" class="mdui-list-item mdui-ripple ">å‘å¸ƒæ—¶é—´åˆ†æ</a>-->
<!--      &lt;!&ndash;<a href="{% url 'weather_show_app:favcount' %}" class="mdui-list-item mdui-ripple ">å–œæ¬¢æ•°åˆ†æ</a>&ndash;&gt;-->
<!--        <a href="{% url 'weather_show_app:area' %}" class="mdui-list-item mdui-ripple ">æˆ¿æºé¢ç§¯åˆ†æ</a>-->
<!--      &lt;!&ndash;<a href="{% url 'weather_show_app:favcount' %}" class="mdui-list-item mdui-ripple ">å–œæ¬¢æ•°åˆ†æ</a>&ndash;&gt;-->
<!--        &lt;!&ndash;<a href="{% url 'weather_show_app:facilityPage' %}" class="mdui-list-item mdui-ripple ">æˆ¿æº</a>&ndash;&gt;-->
<!--        <a href="{% url 'weather_show_app:facilityPage' %}" class="mdui-list-item mdui-ripple ">æˆ¿æºè®¾æ–½åˆ†æ</a>-->
<!--             <a ><div class="mdui-divider"></div></a>-->
<!--        <a href="{% url 'weather_show_app:assess' %}" class="mdui-list-item mdui-ripple ">æˆ¿æºä»·æ ¼è¯„ä¼°</a>-->

    </div>
  </div>

  </div>
</div>
<a id="anchor-top"></a>
{% endblock %}
{#å…¶ä¸­ä¸€ä¸ªéƒ¨åˆ†#}




{% block app_name %}
{{ app_name }}
{% endblock %}

{% block name %}
{{ app_name }}
{% endblock %}

{% block content %}
<div class="mdui-container doc-container">
{#    è¿™å„¿æ‰æ˜¯å†…å®¹çš„åŒºåŸŸå‘¢#}
  <h1 class="doc-title mdui-text-color-theme">{{ app_name }}</h1>
  <div class="doc-intro mdui-typo">



<!--{{today_weather.dressing_index}}-{{today_weather.dressing_index_desc}}-->

<form action="{% url 'weather_show_app:host' %}" id="choice_city" method="GET">

<select id="city_id" class="mdui-select" name="city_id" form="choice_city">   # todo æäº¤è¡¨å•è¿™ä¸ªä¸œè¥¿å¯ä»¥
  <option  value="{{now_city.id}}" selected>{{now_city.name}}</option>
        {% for city in all_citys %}
  <option id="city_{{city.id}}" value="{{city.id}}">{{city.direct_city_name}}</option>
        {% endfor %}
</select>


    <select name="select_date" id="select_date" class="mdui-select" form="choice_city">   # todo æäº¤è¡¨å•è¿™ä¸ªä¸œè¥¿å¯ä»¥
  <option  value="{{today_weather.date|clean_mydate}}" selected>{{today_weather.date|clean_mydate}}</option>
            {% for date in past_dates %}
      <option id="city_{{date|clean_mydate}}" value="{{date|clean_mydate}}">{{date|clean_mydate}}</option>
            {% endfor %}
    </select>

<!--    <input name='select_date' type="date" value="{{today_weather.date|clean_mydate}}"/>-->
<!--    æ—¥æœŸé€‰æ‹©-->


    <input type="submit">
    <br>


    <h2>
    å½“å¤©å¤©æ°”æƒ…å†µ
</h2>
</form>
<br><div class="mdui-chip">
  <span class="mdui-chip-title">å¤©æ°”æƒ…å†µï¼š{{today_weather.state}}</span>
</div><br>
        <div class="mdui-chip">
  <span class="mdui-chip-title">å¤©æ°”ä½“æ„Ÿï¼š{{ today_weather.dressing_index}}</span>
</div><br>
       <div class="mdui-chip">
  <span class="mdui-chip-title">å‡ºè¡Œæ¨èï¼š{{ today_weather.state | state_to_outdoor_guide }}</span>
</div><br>
      <div class="mdui-chip">
  <span class="mdui-chip-title">ç©¿è¡£æŒ‡æ•°ï¼š{{ today_weather | wear_clothing_guide }}</span>
</div><br>


      <h2>24å°æ—¶AQIå›¾</h2>

   <div id="get_hostDraw_chart-hide">
    <div class="mdui-center mdui-spinner mdui-spinner-colorful" style="margin-top: 200px;"></div>
    </div>
<div class="mdui-center" id="get_hostDraw" style="width:800px; height:400px;margin-top: 50px;"></div>
    <script>



        //        $('#select_city').change(function(){
//            var city_id = $('#select_city option:selected').val();
//            now_city_id = city_id;
//            //ä¾æ¬¡å¯åŠ¨è¿™å‡ ä¸ªå›¾è¡¨
//         });


        var get_hostDraw_chart = echarts.init(document.getElementById('get_hostDraw'), 'black', {renderer: 'canvas'});
        $(
            function (){
                fetchget_hostDrawData(get_hostDraw_chart);
                //{#setInterval(fetchData, 100000);#}
            }
        );

        function fetchget_hostDrawData() {
            retry_counter = 0
            $.ajax({
                type: "GET",
                url: "{% url 'weather_show_app:get_today_aqi_line' %}?city_id={{city_id}}&select_date={{select_date}}",
                dataType: 'json',
                async: true,
                timeout:5000,


                success: function (result) {
                    get_hostDraw_chart.setOption(result.data);
                    $('#get_hostDraw_chart-hide').css('display','none');  // ç»„ä»¶å®Œå…¨éšè—ï¼Œä¸å ç”¨æ˜¾ç¤ºæ—¶å ç”¨çš„ä½ç½®
                    $('#get_hostDraw_chart').css('display','block');   //åœ¨è®¾ç½®ç»„ä»¶å¯ä»¥çœ‹
                },
                error : function(XMLHttpRequest,status) { //è¯·æ±‚å®Œæˆåæœ€ç»ˆæ‰§è¡Œå‚æ•°
                    if (status === 'timeout') {
                        //è¶…æ—¶,statusè¿˜æœ‰success,errorç­‰å€¼çš„æƒ…å†µ
                        if (retry_counter > 3){
                            return
                        }else{
                            $.ajax(this).abort();
                        console.log("è¶…æ—¶,å·²é‡è¯•");
                        $.ajax(this);
                        return
                        }


                    }
                }


            });
        }
    </script>




<h2>24å°æ—¶é£åŠ›é›·è¾¾å›¾</h2>

    <div class="mdui-center" id="timeline" style="width:800px; height:400px;margin-top:50px;"></div>
    <script>
        var timeline_chart = echarts.init(document.getElementById('timeline'), 'white', {renderer: 'canvas'});
        $(
            function () {
                fetchData_timeline(timeline_chart);
                //{#setInterval(fetchData_timeline, 10000);#}
            }
        );

        function fetchData_timeline() {
            $.ajax({
                type: "GET",
                url: "{% url 'weather_show_app:get_hostReplay' %}?city_id={{city_id}}&select_date={{select_date}}",
                dataType: 'json',
                async: true,
                timeout:5000,

                success: function (result) {
                    timeline_chart.setOption(result.data);
                },
                error : function(XMLHttpRequest,status) { //è¯·æ±‚å®Œæˆåæœ€ç»ˆæ‰§è¡Œå‚æ•°
                    if (status === 'timeout') {
                        //è¶…æ—¶,statusè¿˜æœ‰success,errorç­‰å€¼çš„æƒ…å†µ
                        if (retry_counter > 3){
                            return
                        }else{
                            $.ajax(this).abort();
                        console.log("è¶…æ—¶,å·²é‡è¯•");
                        $.ajax(this);
                        return
                        }


                    }
                }

            });
        }
    </script>

          <div class="mdui-center" id="draw_relative_humidity" style="width:800px; height:400px;"></div>
    <script>
        var drawmap_humidity_chart = echarts.init(document.getElementById('draw_relative_humidity'), 'white', {renderer: 'canvas'});
        $(
            function () {
                fetchData_humidity_drawmap(drawmap_humidity_chart);
                //{#setInterval(fetchData_drawmap, 10000);#}
            }
        );
        //
        function fetchData_humidity_drawmap() {
            $.ajax({
                type: "GET",
                url: "{% url 'weather_show_app:draw_relative_humidity' %}?city_id={{city_id}}&select_date={{select_date}}",
                dataType: 'json',
                async: true,
                timeout:5000,   //15ç§’

                success: function (result) {
                    drawmap_humidity_chart.setOption(result.data);
                },
                error : function(XMLHttpRequest,status) { //è¯·æ±‚å®Œæˆåæœ€ç»ˆæ‰§è¡Œå‚æ•°
                    if (status === 'timeout') {
                        if (retry_counter > 3){
                            mdui.alert('å·²è¶…æ—¶...');
                            return
                        }else{
                            $.ajax(this).abort();
                        console.log("è¶…æ—¶,å·²é‡è¯•");
                        $.ajax(this);
                        return
                        }


                    }
                }

            });
        }


    </script>

{#è¿™ä¸ªæ˜¯åœ°å›¾#}
        <br>
    <br>
    <div class="mdui-center" id="drawmap" style="width:800px; height:400px;"></div>
    <script>
        var drawmap_chart = echarts.init(document.getElementById('drawmap'), 'white', {renderer: 'canvas'});
        $(
            function () {
                fetchData_drawmap(drawmap_chart);
                //{#setInterval(fetchData_drawmap, 10000);#}
            }
        );
        //
        function fetchData_drawmap() {
            $.ajax({
                type: "GET",
                url: "{% url 'weather_show_app:today_temperature_line' %}?city_id={{city_id}}&select_date={{select_date}}",
                dataType: 'json',
                async: true,
                timeout:5000,   //15ç§’

                success: function (result) {
                    drawmap_chart.setOption(result.data);
                },
                error : function(XMLHttpRequest,status) { //è¯·æ±‚å®Œæˆåæœ€ç»ˆæ‰§è¡Œå‚æ•°
                    if (status === 'timeout') {
                        //è¶…æ—¶,statusè¿˜æœ‰success,errorç­‰å€¼çš„æƒ…å†µ
                        if (retry_counter > 3){
                            mdui.alert('å·²è¶…æ—¶...');
                            return
                        }else{
                            $.ajax(this).abort();
                            console.log("è¶…æ—¶,å·²é‡è¯•");

                            $.ajax(this);
                        return
                        }


                    }
                }

            });
        }


    </script>



</div>


      <h2>
          æœªæ¥å‡ å¤©å¤©æ°”æƒ…å†µ
      </h2>
      <div class="mdui-table-fluid">
          <table class="mdui-table">
            <thead>
              <tr>
                <th>æ—¥æœŸ</th>
                <th>å¤©æ°”æƒ…å†µ</th>
                <th>æœ€é«˜æ¸©</th>
                <th>æœ€ä½æ¸©</th>
                <th>é£åŠ›</th>
                <th>é£å‘</th>


              </tr>
            </thead>
            <tbody>
            {% if future_weathers %}
            {% for weather in  future_weathers %}
              <tr>
                <td>{{weather.date}}</td>
                <td>{{weather.state}}</td>
                <td>{{weather.max_temperature}}</td>
                <td>{{weather.min_temperature}}</td>
                <td>{{weather.wind_power}}</td>
                <td>{{weather.wind_direction}}</td>
              </tr>
              {% endfor %}
            {% else %}
            ğŸ˜¬æš‚æ—¶æ²¡æœ‰æœªæ¥çš„å¤©æ°”æ•°æ®å“¦ï½
            {% endif %}

            </tbody>
          </table>
        </div>
<br><br>
{% endblock %}

{% block tail %}

<!--åŠ å…¥å–œæ¬¢-->

<div class="mdui-fab-wrapper" mdui-fab="">
      <button class="mdui-fab mdui-ripple mdui-color-theme-accent">
        <i class="mdui-icon material-icons">add</i>
        <i class="mdui-icon mdui-fab-opened material-icons">mode_edit</i>
      </button>
      <div class="mdui-fab-dial" style="height: 0px;">
        <!--<button class="mdui-fab mdui-fab-mini mdui-ripple mdui-color-pink" style="transition-delay: 0ms;">-->
            <!--<i class="mdui-icon material-icons">backup</i></button>-->


        <button id="add_mark" mdui-tooltip="{content: 'åŠ å…¥æ”¶è—', position: 'left'}" class="mdui-fab mdui-fab-mini
        mdui-ripple mdui-color-red" style="transition-delay: 15ms;">
            <i class="mdui-icon material-icons">bookmark</i></button>
        <!--<button id="del_mark" mdui-tooltip="{content: 'ä»æ”¶è—ä¸­åˆ é™¤', position: 'left'}" class="mdui-fab mdui-fab-mini mdui-ripple mdui-color-orange" style="transition-delay: 30ms;">-->
            <!--<i class="mdui-icon material-icons">delete_forever</i></button>-->

          <!--è¿™ä¸ªæ˜¯å•¥-->
          <!--<div >-->
              <!--<div class="mdui-dialog-title">Are you sure?</div>-->
              <!--<div class="mdui-dialog-content">You'll lose all photos and media!</div>-->
              <!--<div class="mdui-dialog-actions">-->
                <!--<button class="mdui-btn mdui-ripple">cancel</button>-->
                <!--<button class="mdui-btn mdui-ripple">erase</button>-->
              <!--</div>-->
            <!--</div>-->
        <!--<button class="mdui-fab mdui-fab-mini mdui-ripple mdui-color-blue" style="transition-delay: 45ms;">-->
            <!--<i class="mdui-icon material-icons">touch_app</i></button>-->
      </div>
    </div>




{% endblock %}
  </div>

</div>

